<!DOCTYPE html>
<html>
	    <!--<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />-->


	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
		*{   
			padding: 0px;
			margin: 0px;             
		}
			#wrap {
				width: 400px;
				height: 400px;
				border: 1px solid black;
			}

			.mindiv {  
				width: 20px;
				height: 20px;
				background-color: yellow;
				border: 1px solid lightgrey;
				float: left;
				box-sizing: border-box;
			}

			.red {
				background-color: red;
			}
			.green{
				background-color: green;
			}
		</style>
	</head>

	<body>
		<div id="wrap"></div>
	</body>
	<script type="text/javascript">
	//é£Ÿç‰©åæ ‡
	var fooX = null;
	var fooY = null;
		var wrap = document.getElementById("wrap");
		var rowNumber = 20;
		var collNumber = 20;
		//å­˜æ”¾æ‰€æœ‰divçš„äºŒç»´æ•°ç»„
		//å­˜æ”¾çš„å°æ•°ç»„
		//æ¯ä¸€ä¸ªæ•°ç»„é‡Œé¢è£…çš„æ˜¯
		//ä¸€è¡Œä¸­æ‰€æœ‰çš„div
		var allDiv = [];
		var snakeLength = 3; //ğŸçš„é•¿åº¦
		var snakeArray = [] //ç”¨æ¥è£…æ•´æ¡ğŸ
		//æ§åˆ¶æ•´ä¸ªæ¸¸æˆçš„å®šæ—¶å™¨
		var timer = null;
		var snakeHeader = snakeLength - 1; //ğŸå¤´
		var direction = "right";
		var x = 0; //é»˜è®¤èˆŒå¤´çš„æ‰€åœ¨è¡Œ
		//		åˆ›å»ºæ¸¸æˆé¢æ¿
		//		åˆ›å»ºäºŒç»´æ•°ç»„
		createMapAndArray();

		function createMapAndArray() {
			//å¤–å±‚foræ§åˆ¶è¡Œ
			//å†…è¡Œforæ§åˆ¶åˆ—
			for (var i = 0; i < rowNumber; i++) {
				var rowArray = [];
				//æ¯ä¸€æ¬¡å¼€å§‹åˆ›å»ºè¡Œçš„æ—¶å€™ï¼Œå‡†å¤‡ä¸€ä¸ªrowArray ç”¨æ¥è£…è¿™ä¸€è¡Œçš„æ‰€æœ‰div
				for (var j = 0; j < collNumber; j++) {
					var minDiv = document.createElement("div");
					wrap.appendChild(minDiv);
					minDiv.className = "mindiv";
					rowArray.push(minDiv);
				}
				allDiv.push(rowArray);
			} //forç»“æŸ
		}
		//è®©ğŸåœ¨é¢æ¿ä¸Šå±•ç¤ºå‡ºæ¥
		showoMySnake();

		function showoMySnake() {
			for (var i = 0; i < snakeLength; i++) {
				allDiv[0][i].className = "mindiv red";
				snakeArray[i] = allDiv[0][i];
			}
		}
		gameStart();
		//æ¸¸æˆç»“æŸçš„æ–¹æ³•
		function gameOver() {
			console.log("æ¸¸æˆç»“æŸ");
			clearTimeout(timer);
		}
		//æ˜¯å¦ç¢°åˆ°è‡ªå·±çš„æ–¹æ³•
		function checkMe(tou){
			for(var i =0;i<snakeArray.length;i++){
				if(snakeArray[i]==tou){
					return true;
				}
			}
			return false;
		}
		//ğŸå°¾å·´æ¶ˆå¤±çš„æ–¹æ³•
		function tailHide() {
			console.log("å°¾å·´æ¶ˆå¤±");
			snakeArray[0].className = "mindiv";
		}
		//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©çš„æ–¹æ³•
		function isAteFood() {
			var nextPointX = x;
			var nextPointY=snakeHeader;
		   if(direction=="top"){
		   	nextPointX--;
		   }if(direction=="bottom"){
		   	nextPointX++;
		   }
		   if(direction=="left"){
		   	nextPointY--;
		   }if(direction=="right"){
            	nextPointY++;
		   }
		   if(nextPointX==fooX&&nextPointY==fooY){
		   	return true;
		   }
		   else{
		   	return false;
		   }

		}
		//ç§»åŠ¨çš„æ–¹æ³•
		function move() {
			for (var i = 0; i < snakeArray.length; i++) {
				snakeArray[i] = snakeArray[i + 1];
			}
		}
//é£Ÿç‰©æ˜¯å¦å‡ºç°åœ¨ğŸèº«ä¸Š
		function isOnSnake() {
			if(allDiv[fooX][fooY].className=="mindiv red"){
				return true;
			}else{
				return false;
			}

		}
		//åˆ›å»ºé£Ÿç‰©
		createFood();

		function createFood() {
			 fooX = parseInt(Math.random() * collNumber);
			 fooY = parseInt(Math.random() * rowNumber);
			if (isOnSnake()) {
				createFood();
			} else {
				allDiv[fooX][fooY].className = "mindiv green";
			}
		}
		//é”®ç›˜ç‚¹å‡»äº‹ä»¶
		document.onkeydown = function(event) {

			//æ’é™¤ç›¸åæ–¹å‘

			switch (event.keyCode) {
				case 37:
				if(direction=="right"){
					direction = "right";
				}else{
					direction = "left";
				}
					break;
				case 38:
				if(direction=="bottom"){
					direction = "bottom";
				}else{
					direction = "top";
				}

					break;
				case 39:
				if(direction=="left"){
					direction = "left";
				}else{
					direction = "right";
				}

					break;
				case 40:
				if(direction=="top"){
					direction = "top";
				}else{
					direction = "bottom";
				}
					break;
				default:
					break;
			}
		}
		//å¤´æ˜¾ç¤º
		function headShow() {
			snakeArray[snakeArray.length - 1].className = "mindiv red";
		}

		function gameStart() {
			//		ğŸè¦å‘æŸä¸€ä¸ªæ–¹å‘ç§»åŠ¨
			switch (direction) {
				case "left":
				//æœ‰æ²¡æœ‰ç¢°åˆ°å¢™å£
					if (snakeHeader<= 0) {
						gameOver();

						break;
					}
					var tou = allDiv[x][snakeHeader - 1];
					//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
					if (checkMe(tou)) {
						gameOver();
						break;
					}
					tailHide();
					//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
					if (isAteFood()) {
						//åƒåˆ°é£Ÿç‰©
						snakeArray.push(allDiv[fooX][fooY]);
						snakeLength++;
						createFood();
					} else {
						//æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						//æ­£å¸¸ç§»åŠ¨
						move();
						snakeArray[snakeArray.length - 1] = allDiv[x][snakeHeader - 1];
					}
					//å¤´æ˜¾ç¤º
					headShow();
					snakeHeader--;
					timer = setTimeout(gameStart, 200);
					break;
				case "right":
					//æœ‰æ²¡æœ‰ç¢°åˆ°å¢™å£
					if (snakeHeader + 1 >= collNumber) {
						gameOver();
						break;
					}
					var tou = allDiv[x][snakeHeader + 1];
					//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
					if (checkMe()) {
						gameOver();
						break;
					}
					tailHide();
					//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
					if (isAteFood()) {
						//åƒåˆ°é£Ÿç‰©
						snakeArray.push(allDiv[fooX][fooY]);
						snakeLength++;
						createFood();
					} else {
						//æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						//æ­£å¸¸ç§»åŠ¨
						move();
						snakeArray[snakeArray.length - 1] = allDiv[x][snakeHeader + 1];
					}
					//å¤´æ˜¾ç¤º
					headShow();
					snakeHeader++;
					timer = setTimeout(gameStart, 200);
					break;
				case "top":
					//æœ‰æ²¡æœ‰ç¢°åˆ°å¢™å£
					if (x <= 0) {
						gameOver();
						break;
					}
					var tou = allDiv[x-1][snakeHeader];
					//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
					if (checkMe()) {
						gameOver();
						break;
					}
					tailHide();
					//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
//					èˆŒå¤´çš„ä¸‹ä¸€ä¸ªåæ ‡æ˜¯ä¸æ˜¯ç­‰äº[fooX][fooY]
					if (isAteFood()) {
						//åƒåˆ°é£Ÿç‰©
						snakeArray.push(allDiv[fooX][fooY]);
						snakeLength++;
						createFood();
					} else {
						//æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						//æ­£å¸¸ç§»åŠ¨
						move();
						snakeArray[snakeArray.length - 1] = allDiv[x-1][snakeHeader];
					}
					//å¤´æ˜¾ç¤º
					headShow();
					x--;
					timer = setTimeout(gameStart, 200);
					break;
				case "bottom":
					//æœ‰æ²¡æœ‰ç¢°åˆ°å¢™å£
					if (x + 1 >= rowNumber) {
						gameOver();
						break;
					}
					var tou = allDiv[x+1][snakeHeader];
					//æœ‰æ²¡æœ‰ç¢°åˆ°è‡ªå·±çš„èº«ä½“
					if (checkMe()) {
						gameOver();
						break;
					}
					tailHide();
					//æœ‰æ²¡æœ‰åƒåˆ°é£Ÿç‰©
					if (isAteFood()) {
						//åƒåˆ°é£Ÿç‰©
						snakeArray.push(allDiv[fooX][fooY]);
						snakeLength++;
						createFood();
					} else {
						//æ²¡æœ‰åƒåˆ°é£Ÿç‰©
						//æ­£å¸¸ç§»åŠ¨
						move();
						snakeArray[snakeArray.length - 1] = allDiv[x+1][snakeHeader];
					}
					//å¤´æ˜¾ç¤º
					headShow();
					x++;
					timer = setTimeout(gameStart, 200);
					break;
				default:
					break;
			}
		}
	</script>

</html>
